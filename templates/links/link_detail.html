{% extends "base.html" %}
{% block title %}Détails du lien - Shorty{% endblock %}

{% block content %}
  <div class="flex items-start justify-between gap-4">
    <div class="max-w-2xl">
      <h1 class="text-3xl font-bold">
        {% if link.title %}{{ link.title }}{% else %}{{ link.slug }}{% endif %}
      </h1>

      <p class="mt-4 text-slate-300 break-all">
        <span class="text-slate-400">URL originale :</span> {{ link.original_url }}
      </p>

      <p class="mt-2 text-slate-300 break-all">
        <span class="text-slate-400">URL courte :</span>
        <span id="shortUrl" class="text-white font-semibold">{{ short_url }}</span>
      </p>

      <div class="mt-4 flex gap-3">
        <button onclick="copyShort()"
                class="px-4 py-2 rounded border border-slate-700">
          Copier
        </button>

        <!-- Bouton pour tester la redirection -->
        <a href="{{ short_url }}" target="_blank"
           class="px-4 py-2 rounded bg-white text-slate-950 font-semibold">
          Tester le lien
        </a>
      </div>
    </div>

    <div class="w-72 rounded-2xl border border-slate-800 bg-slate-900/40 p-5">
      <div class="text-sm text-slate-300">Total clicks</div>
      <div class="text-4xl font-bold mt-1">{{ total_clicks }}</div>

      <div class="text-sm text-slate-300 mt-5">Unique clicks (cookie)</div>
      <div class="text-3xl font-semibold mt-1">{{ unique_clicks }}</div>
    </div>
  </div>

  <div class="mt-10 grid md:grid-cols-2 gap-4">
    <div class="rounded-2xl border border-slate-800 bg-slate-900/40 p-6">
      <h2 class="text-lg font-semibold">Top referrers</h2>
      <p class="mt-1 text-sm text-slate-400">
        (Parfois vide selon l’app : WhatsApp, certains navigateurs…)
      </p>

      <div class="mt-4 space-y-2 text-slate-300 text-sm">
        {% for row in top_referrers %}
          <div class="flex justify-between border-b border-slate-800 pb-2 gap-4">
            <span class="truncate">{{ row.referrer }}</span>
            <span class="font-semibold">{{ row.c }}</span>
          </div>
        {% empty %}
          <p class="text-slate-400">Aucune donnée de referrer pour l’instant.</p>
        {% endfor %}
      </div>
    </div>

    <div class="rounded-2xl border border-slate-800 bg-slate-900/40 p-6">
      <h2 class="text-lg font-semibold">Actions</h2>
      <div class="mt-4 space-y-3">
        <a href="{% url 'links:dashboard' %}" class="block px-4 py-2 rounded border border-slate-700">
          ← Retour dashboard
        </a>
      </div>
    </div>
  </div>

  <script>
    // Copie l'URL courte dans le presse-papiers
    function copyShort(){
      const t = document.getElementById("shortUrl").innerText;
      navigator.clipboard.writeText(t);
    }
  </script>
{% endblock %}
